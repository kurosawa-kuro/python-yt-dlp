æ‰¿çŸ¥ã—ã¾ã—ãŸã€‚
**Render / Docker ãã®ã¾ã¾è¼‰ã›æ›¿ãˆå¯èƒ½ãªæœ€å°æ§‹æˆ**ã§ã”ç”¨æ„ã—ã¾ã™ã€‚

ç›®çš„ï¼š

* YouTube URL ã‚’ã‚¯ã‚¨ãƒªå¼•æ•°ã§å—ã‘å–ã‚‹
* æ—¥æœ¬èªå­—å¹•ã‚’å„ªå…ˆå–å¾—
* æ‰‹å‹•å­—å¹• â†’ è‡ªå‹•å­—å¹• fallback
* æœ¬æ–‡ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦è¿”å´

---

# ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
app/
 â”œâ”€ main.py
 â””â”€ requirements.txt
Dockerfile
```

---

# â‘  main.py

```python
from fastapi import FastAPI, HTTPException
import yt_dlp
import tempfile
import os
import glob

app = FastAPI(title="YouTube Subtitle API")


def extract_subtitle(url: str, lang: str = "ja"):
    with tempfile.TemporaryDirectory() as tmpdir:
        ydl_opts = {
            "writesubtitles": True,
            "writeautomaticsub": True,
            "subtitleslangs": [lang],
            "skip_download": True,
            "outtmpl": os.path.join(tmpdir, "%(id)s"),
            "quiet": True,
        }

        with yt_dlp.YoutubeDL(ydl_opts) as ydl:
            try:
                ydl.extract_info(url, download=True)
            except Exception as e:
                raise RuntimeError(str(e))

        subtitle_files = glob.glob(os.path.join(tmpdir, "*.vtt"))

        if not subtitle_files:
            return None

        with open(subtitle_files[0], "r", encoding="utf-8") as f:
            return f.read()


@app.get("/subtitle")
def get_subtitle(url: str):
    if not url:
        raise HTTPException(status_code=400, detail="URL required")

    try:
        subtitle_text = extract_subtitle(url)

        if not subtitle_text:
            raise HTTPException(status_code=404, detail="Subtitle not found")

        return {
            "success": True,
            "subtitle": subtitle_text
        }

    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```

---

# â‘¡ requirements.txt

```
fastapi
uvicorn
yt-dlp
```

---

# â‘¢ Dockerfileï¼ˆRenderå‘ã‘ï¼‰

```dockerfile
FROM python:3.11-slim

RUN apt-get update && \
    apt-get install -y ffmpeg && \
    apt-get clean

WORKDIR /app

COPY app/requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY app/ .

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "10000"]
```

---

# ğŸš€ ãƒ­ãƒ¼ã‚«ãƒ«èµ·å‹•

```bash
docker build -t yt-api .
docker run -p 10000:10000 yt-api
```

ã‚¢ã‚¯ã‚»ã‚¹ï¼š

```
http://localhost:10000/subtitle?url=https://www.youtube.com/watch?v=xxxx
```

---

# ğŸ”’ å®‰å®šåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆæ¨å¥¨ï¼‰

æœ¬ç•ªã§ã¯ä»¥ä¸‹ã‚’è¿½åŠ æ¨å¥¨ï¼š

```python
"nocheckcertificate": True,
"forceipv4": True,
"retries": 3,
```

---

# âš  Renderç„¡æ–™ãƒ—ãƒ©ãƒ³æ³¨æ„ç‚¹

* 15åˆ†ãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ¶é™
* ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆ
* YouTubeãŒãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼IPã‚’å¼¾ãå¯èƒ½æ€§

ã‚‚ã—ä¸å®‰å®šãªã‚‰ï¼š

* cookies.txt ä½¿ç”¨
* VPSé‹ç”¨ã¸åˆ‡æ›¿
* residential proxy

---

# ğŸ“ˆ æ¬¡æ®µéšï¼ˆã‚ãªãŸå‘ã‘è¨­è¨ˆï¼‰

å°†æ¥çš„ã«ï¼š

```
Flutter / Web
      â†“
FastAPI (å­—å¹•å–å¾—)
      â†“
PostgreSQLä¿å­˜
      â†“
è¦ç´„LLMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
```

ã«æ‹¡å¼µå¯èƒ½ã§ã™ã€‚

---

å¿…è¦ã§ã‚ã‚Œã°ï¼š

* VTT â†’ ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›ç‰ˆ
* SRTå¤‰æ›ç‰ˆ
* éåŒæœŸå®Ÿè£…ç‰ˆ
* Kuberneteså¯¾å¿œç‰ˆ

ã¾ã§å‡ºã—ã¾ã™ã€‚

ã©ã®ãƒ¬ãƒ™ãƒ«ã¾ã§ä½œã‚Šè¾¼ã¿ã¾ã™ã‹ï¼Ÿ
